/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package filosuvm;


import java.awt.Component;
import java.awt.Cursor;
import java.awt.Image;
import java.awt.image.BufferedImage;
import java.io.ByteArrayInputStream;
import java.io.ByteArrayOutputStream;
import java.io.File;
import java.io.FileInputStream;
import java.io.IOException;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Date;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.imageio.ImageIO;
import javax.swing.ImageIcon;
import javax.swing.JButton;
import javax.swing.JFileChooser;
import javax.swing.JFrame;
import javax.swing.JOptionPane;
import javax.swing.table.DefaultTableModel;

/**
 *
 * @author luisn
 */
public class Home extends java.awt.Frame {
    public static Movie movie;
    ArrayList <Movie> movies;
    String imageSrc;
    ConnectionDB conn = new ConnectionDB();
     String nomP; 
     int cant,precio;
     DefaultTableModel modelo=new DefaultTableModel(); 
      int id=0;
      int Tpagar=0;
    
    /**
     * Creates new form Home
     */
    public Home() {
        initComponents();
        User userLogin = Login.userLogin;
        String typeUser = userLogin.getType();
        this.setExtendedState(JFrame.MAXIMIZED_BOTH);
        btnClose.setCursor(new Cursor(HAND_CURSOR));
        getMovies();
        
        switch(typeUser){
            case "gerente":
                btnMovie.setVisible(true);
                btnCandy.setVisible(true);
                btnRegister.setVisible(true);
                btnReport.setVisible(true);
                break;
            case "tienda":
                btnMovie.setVisible(false);
                btnCandy.setVisible(true);
                btnRegister.setVisible(false);
                btnReport.setVisible(false);
                break;
            case "cajero":
                btnMovie.setVisible(true);
                btnCandy.setVisible(false);
                btnRegister.setVisible(false);
                btnReport.setVisible(false);
                break;
            default:
                btnMovie.setVisible(false);
                btnCandy.setVisible(false);
                btnRegister.setVisible(false);
                btnReport.setVisible(false);
        }
        
        
        pack();
        
    }
    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jButton7 = new javax.swing.JButton();
        pnlRoot = new javax.swing.JPanel();
        Header = new javax.swing.JPanel();
        jPanel1 = new javax.swing.JPanel();
        btnClose = new javax.swing.JButton();
        pnlSide = new javax.swing.JPanel();
        Reports = new javax.swing.JPanel();
        btnReport = new javax.swing.JButton();
        Movies = new javax.swing.JPanel();
        btnMovie = new javax.swing.JButton();
        jPanel7 = new javax.swing.JPanel();
        btnRegister = new javax.swing.JButton();
        pnlCandy = new javax.swing.JPanel();
        btnCandy = new javax.swing.JButton();
        pnlContent = new javax.swing.JPanel();
        MoviePanel = new javax.swing.JPanel();
        bntMovie1 = new javax.swing.JButton();
        bntMovie2 = new javax.swing.JButton();
        jButton12 = new javax.swing.JButton();
        jButton11 = new javax.swing.JButton();
        jButton15 = new javax.swing.JButton();
        jButton13 = new javax.swing.JButton();
        jButton14 = new javax.swing.JButton();
        jButton16 = new javax.swing.JButton();
        jButton17 = new javax.swing.JButton();
        CandyPanel = new javax.swing.JPanel();
        jPanel2 = new javax.swing.JPanel();
        palomitas = new javax.swing.JButton();
        refresco = new javax.swing.JButton();
        nachos = new javax.swing.JButton();
        barraC = new javax.swing.JButton();
        helado = new javax.swing.JButton();
        jButton5 = new javax.swing.JButton();
        jScrollPane2 = new javax.swing.JScrollPane();
        TablaDetalle = new javax.swing.JTable();
        jLabel1 = new javax.swing.JLabel();
        textTp = new javax.swing.JTextField();
        eliminarP = new javax.swing.JButton();
        ReportPanel = new javax.swing.JPanel();
        RegisterMovie = new javax.swing.JPanel();
        btnSubmit = new javax.swing.JButton();
        lblLength = new javax.swing.JLabel();
        lblNombrePelicula = new javax.swing.JLabel();
        txtLength = new javax.swing.JTextField();
        lblPremiere = new javax.swing.JLabel();
        jdtPremiere = new com.toedter.calendar.JDateChooser();
        jbcCinema = new javax.swing.JComboBox<>();
        lblClasificacion1 = new javax.swing.JLabel();
        txtNameMovie = new javax.swing.JTextField();
        lblClasificacion2 = new javax.swing.JLabel();
        jbcRating = new javax.swing.JComboBox<>();
        lblRating = new javax.swing.JLabel();
        jScrollPane1 = new javax.swing.JScrollPane();
        txtaDescription = new javax.swing.JTextArea();
        lblImage = new javax.swing.JLabel();
        btnChooseFile = new javax.swing.JButton();

        jButton7.setText("jButton7");

        setUndecorated(true);
        addWindowListener(new java.awt.event.WindowAdapter() {
            public void windowClosing(java.awt.event.WindowEvent evt) {
                exitForm(evt);
            }
        });

        pnlRoot.setPreferredSize(new java.awt.Dimension(1500, 1080));
        pnlRoot.setLayout(new java.awt.BorderLayout());

        Header.setBackground(new java.awt.Color(28, 34, 43));
        Header.setPreferredSize(new java.awt.Dimension(100, 60));
        Header.setLayout(new java.awt.BorderLayout());

        jPanel1.setBackground(new java.awt.Color(28, 34, 43));
        jPanel1.setPreferredSize(new java.awt.Dimension(200, 100));
        jPanel1.setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        btnClose.setBackground(new java.awt.Color(28, 34, 43));
        btnClose.setIcon(new javax.swing.ImageIcon(getClass().getResource("/filosuvm/icons/delete_32px.png"))); // NOI18N
        btnClose.setBorder(null);
        btnClose.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnCloseActionPerformed(evt);
            }
        });
        jPanel1.add(btnClose, new org.netbeans.lib.awtextra.AbsoluteConstraints(120, 0, 80, 60));

        Header.add(jPanel1, java.awt.BorderLayout.LINE_END);

        pnlRoot.add(Header, java.awt.BorderLayout.PAGE_START);

        pnlSide.setBackground(new java.awt.Color(246, 19, 64));
        pnlSide.setPreferredSize(new java.awt.Dimension(300, 100));
        pnlSide.setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        Reports.setBackground(new java.awt.Color(246, 19, 64));
        Reports.setLayout(new java.awt.BorderLayout());

        btnReport.setBackground(new java.awt.Color(246, 19, 64));
        btnReport.setIcon(new javax.swing.ImageIcon(getClass().getResource("/filosuvm/icons/notas.png"))); // NOI18N
        btnReport.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnReportActionPerformed(evt);
            }
        });
        Reports.add(btnReport, java.awt.BorderLayout.CENTER);

        pnlSide.add(Reports, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 590, 300, 140));

        Movies.setBackground(new java.awt.Color(246, 19, 64));
        Movies.setLayout(new java.awt.BorderLayout());

        btnMovie.setBackground(new java.awt.Color(246, 19, 64));
        btnMovie.setIcon(new javax.swing.ImageIcon(getClass().getResource("/filosuvm/icons/claqueta.png"))); // NOI18N
        btnMovie.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnMovieActionPerformed(evt);
            }
        });
        Movies.add(btnMovie, java.awt.BorderLayout.CENTER);

        pnlSide.add(Movies, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 170, 300, 140));

        jPanel7.setBackground(new java.awt.Color(246, 19, 64));
        jPanel7.setLayout(new java.awt.BorderLayout());

        btnRegister.setBackground(new java.awt.Color(246, 19, 64));
        btnRegister.setIcon(new javax.swing.ImageIcon(getClass().getResource("/filosuvm/icons/inmigracion.png"))); // NOI18N
        btnRegister.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnRegisterActionPerformed(evt);
            }
        });
        jPanel7.add(btnRegister, java.awt.BorderLayout.CENTER);

        pnlSide.add(jPanel7, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 450, 300, 140));

        pnlCandy.setBackground(new java.awt.Color(246, 19, 64));
        pnlCandy.setLayout(new java.awt.BorderLayout());

        btnCandy.setBackground(new java.awt.Color(246, 19, 64));
        btnCandy.setIcon(new javax.swing.ImageIcon(getClass().getResource("/filosuvm/icons/palomitas-de-maiz.png"))); // NOI18N
        btnCandy.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnCandyActionPerformed(evt);
            }
        });
        pnlCandy.add(btnCandy, java.awt.BorderLayout.CENTER);

        pnlSide.add(pnlCandy, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 310, 300, 140));

        pnlRoot.add(pnlSide, java.awt.BorderLayout.WEST);

        pnlContent.setBackground(new java.awt.Color(255, 255, 255));
        pnlContent.setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        MoviePanel.setBackground(new java.awt.Color(255, 255, 255));
        MoviePanel.setLayout(new java.awt.GridLayout(3, 3, 5, 5));

        bntMovie1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                bntMovie1ActionPerformed(evt);
            }
        });
        MoviePanel.add(bntMovie1);

        bntMovie2.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                bntMovie2ActionPerformed(evt);
            }
        });
        MoviePanel.add(bntMovie2);

        jButton12.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton12ActionPerformed(evt);
            }
        });
        MoviePanel.add(jButton12);

        jButton11.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton11ActionPerformed(evt);
            }
        });
        MoviePanel.add(jButton11);

        jButton15.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton15ActionPerformed(evt);
            }
        });
        MoviePanel.add(jButton15);

        jButton13.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton13ActionPerformed(evt);
            }
        });
        MoviePanel.add(jButton13);

        jButton14.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton14ActionPerformed(evt);
            }
        });
        MoviePanel.add(jButton14);

        jButton16.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton16ActionPerformed(evt);
            }
        });
        MoviePanel.add(jButton16);

        jButton17.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton17ActionPerformed(evt);
            }
        });
        MoviePanel.add(jButton17);

        pnlContent.add(MoviePanel, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 0, 1620, 1020));

        CandyPanel.setBackground(new java.awt.Color(255, 255, 255));
        CandyPanel.setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());
        CandyPanel.add(jPanel2, new org.netbeans.lib.awtextra.AbsoluteConstraints(805, 5, -1, -1));

        palomitas.setBackground(new java.awt.Color(255, 102, 102));
        palomitas.setForeground(new java.awt.Color(0, 0, 51));
        palomitas.setText("palomitas");
        palomitas.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                palomitasActionPerformed(evt);
            }
        });
        CandyPanel.add(palomitas, new org.netbeans.lib.awtextra.AbsoluteConstraints(20, 60, 120, 50));

        refresco.setBackground(new java.awt.Color(255, 102, 102));
        refresco.setForeground(new java.awt.Color(0, 0, 51));
        refresco.setText("refresco");
        refresco.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                refrescoActionPerformed(evt);
            }
        });
        CandyPanel.add(refresco, new org.netbeans.lib.awtextra.AbsoluteConstraints(180, 60, 120, 50));

        nachos.setBackground(new java.awt.Color(255, 102, 102));
        nachos.setForeground(new java.awt.Color(0, 0, 51));
        nachos.setText("nachos");
        nachos.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                nachosActionPerformed(evt);
            }
        });
        CandyPanel.add(nachos, new org.netbeans.lib.awtextra.AbsoluteConstraints(20, 130, 120, 50));

        barraC.setBackground(new java.awt.Color(255, 102, 102));
        barraC.setForeground(new java.awt.Color(0, 0, 51));
        barraC.setText("barra de chocolate");
        barraC.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                barraCActionPerformed(evt);
            }
        });
        CandyPanel.add(barraC, new org.netbeans.lib.awtextra.AbsoluteConstraints(180, 130, 130, 50));

        helado.setBackground(new java.awt.Color(255, 102, 102));
        helado.setForeground(new java.awt.Color(0, 0, 51));
        helado.setText("helado");
        helado.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                heladoActionPerformed(evt);
            }
        });
        CandyPanel.add(helado, new org.netbeans.lib.awtextra.AbsoluteConstraints(340, 60, 120, 50));

        jButton5.setBackground(new java.awt.Color(255, 102, 102));
        jButton5.setForeground(new java.awt.Color(0, 0, 51));
        jButton5.setText("realizar venta");
        jButton5.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton5ActionPerformed(evt);
            }
        });
        CandyPanel.add(jButton5, new org.netbeans.lib.awtextra.AbsoluteConstraints(20, 240, 120, 50));

        TablaDetalle.setBackground(new java.awt.Color(255, 102, 102));
        TablaDetalle.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "id", "producto", "cantidad", "total"
            }
        ));
        jScrollPane2.setViewportView(TablaDetalle);

        CandyPanel.add(jScrollPane2, new org.netbeans.lib.awtextra.AbsoluteConstraints(590, 50, 590, -1));

        jLabel1.setBackground(new java.awt.Color(255, 102, 102));
        jLabel1.setForeground(new java.awt.Color(0, 0, 51));
        jLabel1.setText("total a pagar");
        CandyPanel.add(jLabel1, new org.netbeans.lib.awtextra.AbsoluteConstraints(340, 150, 70, 20));

        textTp.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                textTpActionPerformed(evt);
            }
        });
        CandyPanel.add(textTp, new org.netbeans.lib.awtextra.AbsoluteConstraints(420, 140, 130, 30));

        eliminarP.setBackground(new java.awt.Color(255, 102, 102));
        eliminarP.setForeground(new java.awt.Color(0, 0, 51));
        eliminarP.setText("eliminarP");
        eliminarP.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                eliminarPActionPerformed(evt);
            }
        });
        CandyPanel.add(eliminarP, new org.netbeans.lib.awtextra.AbsoluteConstraints(170, 240, 120, 50));

        pnlContent.add(CandyPanel, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 0, 1620, 1020));

        ReportPanel.setBackground(new java.awt.Color(0, 102, 255));
        pnlContent.add(ReportPanel, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 0, 1620, 1020));

        RegisterMovie.setBackground(new java.awt.Color(255, 255, 255));
        RegisterMovie.setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        btnSubmit.setBackground(new java.awt.Color(28, 34, 43));
        btnSubmit.setFont(new java.awt.Font("Segoe UI", 0, 18)); // NOI18N
        btnSubmit.setForeground(new java.awt.Color(255, 255, 255));
        btnSubmit.setText("Enviar");
        btnSubmit.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnSubmitActionPerformed(evt);
            }
        });
        RegisterMovie.add(btnSubmit, new org.netbeans.lib.awtextra.AbsoluteConstraints(400, 890, 800, 80));

        lblLength.setFont(new java.awt.Font("Segoe UI Black", 0, 18)); // NOI18N
        lblLength.setText("Duracion");
        RegisterMovie.add(lblLength, new org.netbeans.lib.awtextra.AbsoluteConstraints(110, 450, 180, 40));

        lblNombrePelicula.setFont(new java.awt.Font("Segoe UI Black", 0, 18)); // NOI18N
        lblNombrePelicula.setText("Nombre Pelicula");
        RegisterMovie.add(lblNombrePelicula, new org.netbeans.lib.awtextra.AbsoluteConstraints(110, 50, 190, 40));
        RegisterMovie.add(txtLength, new org.netbeans.lib.awtextra.AbsoluteConstraints(110, 500, 500, 40));

        lblPremiere.setFont(new java.awt.Font("Segoe UI Black", 0, 18)); // NOI18N
        lblPremiere.setText("Fecha Estreno");
        RegisterMovie.add(lblPremiere, new org.netbeans.lib.awtextra.AbsoluteConstraints(110, 180, 180, 40));
        RegisterMovie.add(jdtPremiere, new org.netbeans.lib.awtextra.AbsoluteConstraints(110, 240, 500, 40));

        jbcCinema.setFont(new java.awt.Font("Tahoma", 0, 18)); // NOI18N
        jbcCinema.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "1", "2", "3", "4", "5", " " }));
        RegisterMovie.add(jbcCinema, new org.netbeans.lib.awtextra.AbsoluteConstraints(110, 670, 500, 40));

        lblClasificacion1.setFont(new java.awt.Font("Segoe UI Black", 0, 18)); // NOI18N
        lblClasificacion1.setText("Descripcion");
        RegisterMovie.add(lblClasificacion1, new org.netbeans.lib.awtextra.AbsoluteConstraints(970, 40, 180, 40));

        txtNameMovie.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txtNameMovieActionPerformed(evt);
            }
        });
        RegisterMovie.add(txtNameMovie, new org.netbeans.lib.awtextra.AbsoluteConstraints(110, 110, 500, 40));

        lblClasificacion2.setFont(new java.awt.Font("Segoe UI Black", 0, 18)); // NOI18N
        lblClasificacion2.setText("Clasificacion");
        RegisterMovie.add(lblClasificacion2, new org.netbeans.lib.awtextra.AbsoluteConstraints(110, 310, 180, 40));

        jbcRating.setFont(new java.awt.Font("Tahoma", 0, 18)); // NOI18N
        jbcRating.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "AA", "A", "B", "B15", "C", "D" }));
        RegisterMovie.add(jbcRating, new org.netbeans.lib.awtextra.AbsoluteConstraints(110, 370, 500, 40));

        lblRating.setFont(new java.awt.Font("Segoe UI Black", 0, 18)); // NOI18N
        lblRating.setText("Numero de Sala");
        RegisterMovie.add(lblRating, new org.netbeans.lib.awtextra.AbsoluteConstraints(110, 600, 180, 40));

        txtaDescription.setColumns(20);
        txtaDescription.setRows(5);
        jScrollPane1.setViewportView(txtaDescription);

        RegisterMovie.add(jScrollPane1, new org.netbeans.lib.awtextra.AbsoluteConstraints(970, 100, 450, 120));

        lblImage.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0)));
        RegisterMovie.add(lblImage, new org.netbeans.lib.awtextra.AbsoluteConstraints(1030, 370, 340, 360));

        btnChooseFile.setText("Elegir una imagen");
        btnChooseFile.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnChooseFileActionPerformed(evt);
            }
        });
        RegisterMovie.add(btnChooseFile, new org.netbeans.lib.awtextra.AbsoluteConstraints(970, 290, 450, 40));

        pnlContent.add(RegisterMovie, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 0, 1620, 1020));

        pnlRoot.add(pnlContent, java.awt.BorderLayout.CENTER);

        add(pnlRoot, java.awt.BorderLayout.CENTER);

        pack();
    }// </editor-fold>//GEN-END:initComponents
    
    
    public void getMovies(){
        movies = conn.getMovies(); 
        setImages();
    }
    
    public void setImages(){
    //Put all the images in the Buttons
        for(int i =0; i<movies.size();i++){
               reziseImage(movies.get(i).getImage(),i);
        }
    }
    
    
    public void reziseImage(String src,int index){
        Component []components = MoviePanel.getComponents();
        ImageIcon icon = new ImageIcon(new ImageIcon(src).getImage().getScaledInstance(bntMovie1.getWidth(),bntMovie1.getHeight(), Image.SCALE_SMOOTH));
        if(components[index] instanceof JButton){
            JButton button = (JButton) components[index];
            button.setIcon(icon);
        }
    }
    
    
    public ByteArrayInputStream imageFormat(){
        ByteArrayInputStream baisForIndex2 = null;
       try{ 
            BufferedImage imm = ImageIO.read(new File(imageSrc));
            ByteArrayOutputStream baos = new ByteArrayOutputStream();
            ImageIO.write(imm, "jpg", baos );
            baos.flush();
            byte[] immAsBytes = baos.toByteArray();
            baos.close();
            baisForIndex2 = new ByteArrayInputStream(immAsBytes);
       }catch(Exception e){
           System.out.println("Hubo un error");
       }
        
       return baisForIndex2;
    }
    /**
     * Exit the Application
     */
    private void exitForm(java.awt.event.WindowEvent evt) {//GEN-FIRST:event_exitForm
        System.exit(0);
    }//GEN-LAST:event_exitForm

    private void btnMovieActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnMovieActionPerformed
        MoviePanel.setVisible(true);
        CandyPanel.setVisible(false);
        RegisterMovie.setVisible(false);
        ReportPanel.setVisible(false);
    }//GEN-LAST:event_btnMovieActionPerformed

    private void btnCandyActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnCandyActionPerformed
        MoviePanel.setVisible(false);
        CandyPanel.setVisible(true);
        RegisterMovie.setVisible(false);
        ReportPanel.setVisible(false);
    }//GEN-LAST:event_btnCandyActionPerformed

    private void btnRegisterActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnRegisterActionPerformed
        MoviePanel.setVisible(false);
        CandyPanel.setVisible(false);
        RegisterMovie.setVisible(true);
        ReportPanel.setVisible(false);
    }//GEN-LAST:event_btnRegisterActionPerformed

    private void btnReportActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnReportActionPerformed
        MoviePanel.setVisible(false);
        CandyPanel.setVisible(false);
        RegisterMovie.setVisible(false);
        ReportPanel.setVisible(true);
    }//GEN-LAST:event_btnReportActionPerformed

    private void btnCloseActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnCloseActionPerformed
        System.exit(0);
    }//GEN-LAST:event_btnCloseActionPerformed

    private void bntMovie1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_bntMovie1ActionPerformed
        movie = movies.get(0);
        Movies newWindow = new Movies();
        newWindow.setVisible(true);
    }//GEN-LAST:event_bntMovie1ActionPerformed

    private void bntMovie2ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_bntMovie2ActionPerformed
        movie = movies.get(1);
        Movies newWindow = new Movies();
        newWindow.setVisible(true);
    }//GEN-LAST:event_bntMovie2ActionPerformed

    private void jButton12ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton12ActionPerformed
        movie = movies.get(2);
        Movies newWindow = new Movies();
        newWindow.setVisible(true);
    }//GEN-LAST:event_jButton12ActionPerformed

    private void jButton11ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton11ActionPerformed
        movie = movies.get(3);
        Movies newWindow = new Movies();
        newWindow.setVisible(true);;
    }//GEN-LAST:event_jButton11ActionPerformed

    private void jButton15ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton15ActionPerformed
        movie = movies.get(4);
        Movies newWindow = new Movies();
        newWindow.setVisible(true);
    }//GEN-LAST:event_jButton15ActionPerformed

    private void jButton13ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton13ActionPerformed
        movie = movies.get(5);
        Movies newWindow = new Movies();
        newWindow.setVisible(true);
    }//GEN-LAST:event_jButton13ActionPerformed

    private void jButton14ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton14ActionPerformed
        movie = movies.get(6);
        Movies newWindow = new Movies();
        newWindow.setVisible(true);
    }//GEN-LAST:event_jButton14ActionPerformed

    private void jButton16ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton16ActionPerformed
        movie = movies.get(7);
        Movies newWindow = new Movies();
        newWindow.setVisible(true);
    }//GEN-LAST:event_jButton16ActionPerformed

    private void jButton17ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton17ActionPerformed
        movie = movies.get(8);
        Movies newWindow = new Movies();
        newWindow.setVisible(true);
    }//GEN-LAST:event_jButton17ActionPerformed

    private void btnSubmitActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnSubmitActionPerformed
        try {
            int id = movies.size();
            int length = -1;
            String empty = "";
            String nameMovie = txtNameMovie.getText(); 
            String description = txtaDescription.getText();
            Date premiereDate = jdtPremiere.getDate();
            String premiere = new SimpleDateFormat("YYYY-MM-dd").format(premiereDate);
            String lengthValidation = txtLength.getText();
            String rating = (String) jbcRating.getSelectedItem();
            String cinema = (String) jbcCinema.getSelectedItem();
            if(!(lengthValidation.matches("^[0-9]*$"))){
                JOptionPane.showMessageDialog(null,"El campo duracion solo acepta numeros ");
            }
            else if(empty.equals(nameMovie) || empty.equals(description) || empty.equals(premiere)  || imageSrc == null || empty.equals(premiere) || Integer.parseInt(lengthValidation) < 0  || empty.equals(rating) || empty.equals(cinema)  ){
                JOptionPane.showMessageDialog(null,"Todos los campos son obligatorios ");
            }else{
                ByteArrayInputStream baisForIndex2;
                System.out.println(rating);
                System.out.println(cinema);
                length = Integer.parseInt(lengthValidation);
                Movie movie = new Movie(id,nameMovie,imageSrc,length,premiere,description,rating);
                baisForIndex2 = this.imageFormat();
                if(baisForIndex2 !=null){
                    this.conn.setMovie(baisForIndex2,movie);
                    this.getMovies();
                }
            }
        }catch(Exception e){
            JOptionPane.showMessageDialog(null,"Todos los campos son obligatorios ");
        }
    }//GEN-LAST:event_btnSubmitActionPerformed

    private void btnChooseFileActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnChooseFileActionPerformed
       try{
            JFileChooser chooser = new JFileChooser();
            chooser.showOpenDialog(null);
            File image = chooser.getSelectedFile();
            imageSrc = image.getAbsolutePath();
            ImageIcon icon = new ImageIcon(new ImageIcon(imageSrc).getImage().getScaledInstance(lblImage.getWidth(),lblImage.getHeight(), Image.SCALE_SMOOTH));
            lblImage.setIcon(icon);
       }catch(Exception e){
           JOptionPane.showMessageDialog(null, "Toodos los campos son obligatorios");
       }
    }//GEN-LAST:event_btnChooseFileActionPerformed

    private void txtNameMovieActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtNameMovieActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_txtNameMovieActionPerformed

    private void palomitasActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_palomitasActionPerformed
        // TODO add your handling code here:
        nomP="palomitas";
        cant=Integer.parseInt(JOptionPane.showInputDialog("ingrese cantidad"));
        precio=87;
        agregarP();
        calcularT();

    }//GEN-LAST:event_palomitasActionPerformed

    private void refrescoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_refrescoActionPerformed
        // TODO add your handling code here:
        nomP="refresco";
        cant=Integer.parseInt(JOptionPane.showInputDialog("ingrese cantidad"));
        precio=65;
        agregarP();
        calcularT();
    }//GEN-LAST:event_refrescoActionPerformed

    private void nachosActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_nachosActionPerformed
        // TODO add your handling code here:
        nomP="nachos";
        cant=Integer.parseInt(JOptionPane.showInputDialog("ingrese cantidad"));
        precio=72;
        agregarP();
        calcularT();
        calcularT();
    }//GEN-LAST:event_nachosActionPerformed

    private void barraCActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_barraCActionPerformed
        // TODO add your handling code here:
        nomP="barra de chocolate";
        cant=Integer.parseInt(JOptionPane.showInputDialog("ingrese cantidad"));
        precio=45;
        agregarP();
        calcularT();

    }//GEN-LAST:event_barraCActionPerformed

    private void heladoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_heladoActionPerformed
        nomP="helado";
        cant=Integer.parseInt(JOptionPane.showInputDialog("ingrese cantidad"));
        precio=56;
        agregarP();
        calcularT();
    }//GEN-LAST:event_heladoActionPerformed

    private void jButton5ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton5ActionPerformed
        // TODO add your handling code here:
        calcularT();
        JOptionPane.showMessageDialog(null,generarTick()+"\n venta realizada,total a pagar:"+textTp.getText());
        textTp.setText("");
        liberarStock();
        limpiarTable();
     

    }//GEN-LAST:event_jButton5ActionPerformed

    private void textTpActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_textTpActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_textTpActionPerformed

    private void eliminarPActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_eliminarPActionPerformed
        // TODO add your handling code here:
        int fila = TablaDetalle.getSelectedRow();
        if (fila >= 0) {
            modelo.removeRow(fila);
        }
        calcularT();
    }//GEN-LAST:event_eliminarPActionPerformed
public String generarTick(){
    String ticket="";
     ticket="cine uvm sanRafael \n";
     for(int i=0;i<TablaDetalle.getRowCount();i++)
    {  
        ticket+="nombreP: "+TablaDetalle.getValueAt(i,1).toString()+"\n cantidad: "+TablaDetalle.getValueAt(i,2).toString()+"\n total$: "+TablaDetalle.getValueAt(i,3).toString()+"\n-------------------------\n";
        
       
    }
     return ticket;
}
    void agregarP(){
        modelo=(DefaultTableModel)TablaDetalle.getModel();
        String sql="";
        
        id++;
        int total= cant*precio;
        ArrayList lista=new ArrayList();
        ConnectionDB conn = new ConnectionDB();
          ResultSet rs=conn.buscar("select Cantidad from Dulceria where NombreProducto='"+nomP+"'");
        
         try{
            if(rs.next()){
                  if(cant<=rs.getInt(1)){
                      
                  
                      lista.add(id);
                      lista.add(nomP);
                      lista.add(cant);
                      lista.add(total);
                      Object[] ob=new Object[4];
                      ob[0]=lista.get(0);
                       ob[1]=lista.get(1);
                        ob[2]=lista.get(2);
                         ob[3]=lista.get(3);
                         modelo.addRow(ob);
                         TablaDetalle.setModel(modelo);
                  }
                  else{
                       JOptionPane.showMessageDialog(null,"STACK INSUFICIENTE");
                  }
            }
                  
        }
         catch (SQLException ex) {
           
     
        }   
}
void limpiarTable(){
    id=0;
        for(int i=0;i<TablaDetalle.getRowCount();i++)
    {
      modelo.removeRow(i);
      i-=1;
    }
    
}
void liberarStock(){
     for(int i=0;i<TablaDetalle.getRowCount();i++)
    {
        ConnectionDB conn = new ConnectionDB();
          
       int r=conn.editar("update Dulceria set Cantidad=Cantidad-"+TablaDetalle.getValueAt(i,2).toString()+" where NombreProducto='"+TablaDetalle.getValueAt(i,1).toString()+"'");
        
    }
}
void  calcularT(){
    Tpagar=0;
    for(int i=0;i<TablaDetalle.getRowCount();i++)
    {
        
        Tpagar+=Integer.parseInt (TablaDetalle.getValueAt(i,3).toString());
        
    }
    textTp.setText("$"+Tpagar);
  
   
}
    
    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                new Home().setVisible(true);
            }
        });
    }


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JPanel CandyPanel;
    private javax.swing.JPanel Header;
    private javax.swing.JPanel MoviePanel;
    private javax.swing.JPanel Movies;
    private javax.swing.JPanel RegisterMovie;
    private javax.swing.JPanel ReportPanel;
    private javax.swing.JPanel Reports;
    private javax.swing.JTable TablaDetalle;
    private javax.swing.JButton barraC;
    private javax.swing.JButton bntMovie1;
    private javax.swing.JButton bntMovie2;
    private javax.swing.JButton btnCandy;
    private javax.swing.JButton btnChooseFile;
    private javax.swing.JButton btnClose;
    private javax.swing.JButton btnMovie;
    private javax.swing.JButton btnRegister;
    private javax.swing.JButton btnReport;
    private javax.swing.JButton btnSubmit;
    private javax.swing.JButton eliminarP;
    private javax.swing.JButton helado;
    private javax.swing.JButton jButton11;
    private javax.swing.JButton jButton12;
    private javax.swing.JButton jButton13;
    private javax.swing.JButton jButton14;
    private javax.swing.JButton jButton15;
    private javax.swing.JButton jButton16;
    private javax.swing.JButton jButton17;
    private javax.swing.JButton jButton5;
    private javax.swing.JButton jButton7;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JPanel jPanel7;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JScrollPane jScrollPane2;
    private javax.swing.JComboBox<String> jbcCinema;
    private javax.swing.JComboBox<String> jbcRating;
    private com.toedter.calendar.JDateChooser jdtPremiere;
    private javax.swing.JLabel lblClasificacion1;
    private javax.swing.JLabel lblClasificacion2;
    private javax.swing.JLabel lblImage;
    private javax.swing.JLabel lblLength;
    private javax.swing.JLabel lblNombrePelicula;
    private javax.swing.JLabel lblPremiere;
    private javax.swing.JLabel lblRating;
    private javax.swing.JButton nachos;
    private javax.swing.JButton palomitas;
    private javax.swing.JPanel pnlCandy;
    private javax.swing.JPanel pnlContent;
    private javax.swing.JPanel pnlRoot;
    private javax.swing.JPanel pnlSide;
    private javax.swing.JButton refresco;
    private javax.swing.JTextField textTp;
    private javax.swing.JTextField txtLength;
    private javax.swing.JTextField txtNameMovie;
    private javax.swing.JTextArea txtaDescription;
    // End of variables declaration//GEN-END:variables
}
